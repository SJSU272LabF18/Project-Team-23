{% extends "header.html" %}
{% set currenttab = 'accidents-prediction' %}
{% block scriptcontent %}
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" />
	<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
{% endblock %}

{% block bodycontent %}
<div class="accidents-prediction">
	<div class="container-fluid">    
		<div class="row">
			<div class="col-md-4 collision-factors" >
				<h3>Please choose the conditions to predict</h3><br>
				
				<form >
				  <h5>Date and Time</h5>
				  <input type="datetime-local" name="collision_datetime">
				  
				<br><br>
				
				<h5>Lighting</h5>
					<select name="lighting" style="margin-right:20px">
							<option value='A'>DayLight</option>
							<option value='B'>Dusk Dawn</option>
							<option value='C'>Dark - Street Lights</option>
							<option value='D'>Dark - No Street Lights</option>
							<option value='E'>Dark - Street Lights Not Functioning</option>
							<option selected value='_'>Not Stated</option>
					</select>
				<br><br>
				
				
				<h5>Road Conditions</h5>
					<select name="roadCondition" style="margin-right:20px">
							<option value='A'>Holes, Deep Ruts</option>
							<option value='B'>Loose Material on Roadway</option>
							<option value='C'>Obstruction on Roadway</option>
							<option value='D'>Construction or Repair Zone</option>
							<option value='E'>Reduced Roadway Width</option>
							<option value='F'>Flooded</option>
							<option value='G'>Other</option>
							<option value='H'>No Unusual Condition</option>
							<option selected value='_'>Not Stated</option>
					
					</select>
				<br><br>
					
				<h5>Road Surface</h5>
					<select name="roadSurface" style="margin-right:20px">
							<option value='A'>Dry</option>
							<option value='B'>Wet</option>
							<option value='C'>Snowy or Icy</option>
							<option value='D'>Slippery</option>
							<option selected value='_'>Not Stated</option>
					
					</select>
				<br><br>
				
					
				<h5>Weather</h5>
					<select name="weather" style="margin-right:20px">
							<option value='A'>Clear</option>
							<option value='B'>Cloudy</option>
							<option value='C'>Raining</option>
							<option value='D'>Snowing</option>
							<option value='E'>Fog</option>
							<option value='G'>Wind</option>
							<option value='F'>Other</option>	
							<option selected value='_'>Not Stated</option>
					</select>
				<br><br>
					
				<input type="hidden" name ="pointx" id = "pointx"/>	
				<input type="hidden" name ="pointy" id = "pointy"/>	
				</form>
				</div>
				<div class ="col-md-8">
	  				<div style="margin:auto"> <div id= "predictmap"></div></div>
					  <script type="text/javascript">
					      function onMarkerClick(e)
						  {
							document.getElementById("pointx").value = e.latlng.lng;
							document.getElementById("pointy").value = e.latlng.lat;
							$.ajax({
									url: '/predict',
									data: $('form').serialize(),
									type: 'POST',
									success: function(response) {
										e.target.bindPopup(response).openPopup();
										console.log(response);
									}
									
								});
						  }
						  var coordinates = JSON.parse({{ coordinates | tojson | safe}});
						  var map = L.map('predictmap').setView([37.3, -121], 5);
						  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
						  for(i=0;i<coordinates.length;i++)
						  {
							  var marker = L.marker([coordinates[i].y,coordinates[i].x]).addTo(map);
							  marker.on('click', onMarkerClick);
						  }
						  
					  </script>
				</div>
			</div>
		</div>
	</div>
	
{% endblock %}